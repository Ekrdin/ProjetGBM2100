/* ========================================
 *
 * Copyright YOUR COMPANY, THE YEAR
 * All Rights Reserved
 * UNPUBLISHED, LICENSED SOFTWARE.
 *
 * CONFIDENTIAL AND PROPRIETARY INFORMATION
 * WHICH IS THE PROPERTY OF your company.
 *
 * ========================================
*/
#include "project.h"
#include "TraitementdeSignal.h"
#include "FreeRTOS.h"
#include "task.h"

//float testR[BUFFER_LENGTH]  ={374249,374010,374994,374039,374770,374191,375723,374211,375684,374390,375640,374666,376375,374769,376323,375193,376353,375294,376404,375305,376308,375858,376231,375930,376117,376279,375932,376700,375757,376319,375736,377186,375581,376972,375713,377031,375747,377617,375912,377275,376221,377352,376142,377295,376306,377288,376769,377155,376725,377165,377236,377072,377610,376945,377505,377023,378512,377047,378349,377281,378644,377419,379278,377476,378914,377664,379028,377403,378244,376766,377163,375871,375762,374408,374043,373296,372338,372071,370813,370544,369537,370313,368288,368920,367550,368550,367061,368637,366718,367788,366615,368044,366491,367722,366714,367850,367043,367687,367131,367781,367847,367786,368223,367843,368307,368011,369375,368071,369226,368451,369930,368685,370679,369046,370448,369528,371132,369711,371136,370225,371400,370657,371462,370838,371546,371477,371447,371605,371280,371608,370985,372121,370636,371471,370497,371814,370242,371938,370170,371266,370114,371637,369881,371239,369965,371031,369967,370801,369873,370579,370416,370401,370411,370220,370599,370228,371320,370157,371020,370303,371900,370438,372173,370725,372057,371044,372853,371215,372723,371712,372935,371927,372890,372010,372920,372685,372978,372920,372987,373272,372922,373874,372910,373745,373115,374703,373176,374845,373431,374776,373721,375623,373864,375311,374199,375404,374301,375381,374397,375353,374933,375234,374995,375015,375262,374912,375748,374751,375482,374897,376432,374878,376327,374956,376299,375057,376954,375179,376565,375479,376759,375544,376722,375619,376643,376190,376591,376258,376546,376725,376485,377083,376362,376975,376419,377997,376436,377686,376553,377869,376630,378295,376210,377237,375572,376322,374354,374906,373025,373211,371825,371633,370393,370142,369586,368825,368795,367617,367611,366779,367860,365990,366921,365692,366902,365580,367242,365479,366776,365617,367162,365639,366921,365855,366982,366292,366949,366392,367021,367119,367107,367611,367055,367689,367307,368727,367312,368531,367606,369003,367741,369692,368032,369446,368473,370114,370071,370071,368971,370123,369320,370077,369363,369899,369869,369699,369943,369451,369717,369236,370287,368786,369674,368658,369969,368520,370268,368493,369602,368569,370141,368493,369766,368643,369640,368792,369521,368749,369507,369359,369302,369534,369304,369711,369306,370434,369230,370264,369541,371064,369737,371550,370080,371461,370374,372171,370704,372126,371086,372283,371363,372354,371500,372408,372273,372422,372499,372441,372907,372558,373528,372444,373302,372765,374246,372812,374479,373037,374457,373373,375119,373412,374847,373665,374888,373817,374881,373883,374724,374512,374605,374540,374541,374868,374539,375479,374422,375135,374637,376107,374617,376112,374865,376177,375034,376883,375190,376625,375501,376740,375536,376695,375729,376738,376239,376692,376310,376576,376785,376461,377173,376229,376758,376108,377255,375363,376231,374452,375121,373283,374346,371792,372463,370535,371052,369107,369637,368038,368369,367313,367285,366358,366364,366148,365709,366085,365101,365512,364921,366228,364691,365965,364881,366209,365088,366861,365266,366668,365546,367050,365836,367168,366116,367278,366754,367343,366776,367334,367484,367347,367893,367441,367936,367515,369044,367619,368825,367960,369468,368273,370223,368546,369954,368980,370444,369004,370273,369149,370172,369289,369881,369185,369664,369463,369287,369439,368938,369345,368740,369958,368493,369395,368411,369771,368390,370244,368377,369718,368581,370121,368655,369941,368889,370025,369256,370024,369272,369937,369949,369843,370275,370044,370485,370072,371452,370073,371105,370419,371966,370643,372532,370925,372292,371327,373067,371499,373006,371985,373168,372283,373203,372458,373365,373161,373225,373377,373292,373645,373292,374435,373208,374141,373416,374886,373538,375222,373711,374922,373889,375587,373888,375302,374172,375397,374285,375251,374421,375181,374887,375091,374953,374958,375253,374854,375843,374741,375681,374978,376549,375006,376610,375203,376518,375435,377246,375605,377059,375920,377166,376045,377101,376173,377035,376758,376972,376833,376875,377159,376829,377569,376470,377030,376237,377320,375270,376064,374128,374581,372621,373585,371126,371676,369749,370181,368262,368751,367070,367365,366477,366371,365594,365580,365466,364965,365356,364388,364957,364170,365628,364013,365371,364238,365545,364380,366289,364598,365988,364959,366226,365071,366255,365184,366272,365824,366224,365777,366164,366296,366095,366699,366022,366658,366205,367589,366169,367373,366400,367734,366634,368438,366778,368159,367049,368523,367086,368251,367177,368123,367339,367865,367193,367553,367483,367224,367589,366936,367362,366757,368048,366496,367585,366526,367782,366522,368354,366626,367860,366799,368287,366791,368063,367067,368162,367373,368098,367531,368140,368141,368000,368498,368046,368584,368092,369470,368107,369346,368506,369886,368652,370591,368918,370252,369287,370928,369398,370834,369793,370984,370174,371054,370281,371062,371051,371119,371320,371074,371591,371149,372411,371163,372165,371366,372907,371533,373347,371689,373050,371947,373625,372072,373393,372341,373383,372399,373331,372548,373187,372970,373046,373107,372995,373327,373015,374080,372897,373776,373108,374514,373129,374841,373328,374676,373587,375404,373781,375135,374060,375253,374357,375336,374529,375464,375176,375399,375333,375433,375772,375454,376447,375318,376034,375148,376347,374328,375315,373172,373721,371888,372864,370434,371037,369184,369662,367992,368388,366800,367214,366394,366328,365648,365473,365495,364993,365639,364580,365179,364535,365962,364472,365984,364735,366145,365054,366852,365300,366729,365705,367017,365989,367215,366332,367247,366861,367312,367155,367435,367501,367459,368104,367400,368128,367538,369163,367731,369080,368039,369500,368350,370269,368681,369943,368888,370236,368860,369998,368915,369789,369100,369533,368948,369105,369072,368799,369278,368503,368941,368278,369636,368004,369123,368026,369223,368013,369773,368042,369301,368206,369577,368196,369452,368331,369480,368820,369443,368977,369482,369568,369480,370006,369523,370135,369670,371195,369736,371053,370118,371556,370508,372469,370871,372172,371182,372814,371412,372779,371764,372887,372315,373045,372469,373146,373206,373203,373610,373213,373696,373285,374543,373329,374307,373555,374993,373773,375567,373977,375319,374265,375850,374268,375707,374615,375769,374917,375754,375078,375797,375709,375768,375988,375670,376159,375743,376996,375770,376815,376083,377625,376161,378078,376484,377740,376630,378438,376951,378396,377352,378508,377610,378594,377893,378670,378543,378702,378756,378759,379145,378818,379838,378746,379643,378858,380176,378578,380073,378193,379009,377239,378250,375835,376401,374495,374865,373049,373301,371762,371903,370948,370624,370213,369714,369551,368890,369493,368259,368904,368061,369302,367797,369267,367925,369196,368137,369866,368353,369799,368772,370115,369059,370248,369502,370447,370145,370623,370658,370802,371116,371078,371898,371200,371945};
//float testIR[BUFFER_LENGTH] = {196393,197802,196742,197984,196884,197960,196961,197825,197464,197762,197503,197660,197929,197652,198509,197579,198270,197679,199159,197608,199063,197833,199106,197910,199719,197977,199392,198256,199424,198153,199254,198157,199129,198627,198949,198617,198891,198993,198693,199366,198524,199167,198563,200055,198521,199816,198670,199987,198754,200629,198911,200276,199180,200535,199226,200417,199343,200417,199827,200361,199885,200302,200347,200171,200664,199843,200346,199597,200712,198793,199532,197934,198666,196819,198075,195631,196408,194650,195520,193565,194307,192762,193437,192353,192494,191736,191959,191775,191474,191717,190982,191415,190882,192210,190660,191824,190937,192329,191066,193015,191262,192637,191601,193257,191773,193146,192121,193220,192543,193294,192581,193284,193351,193362,193688,193372,193906,193500,194841,193566,194618,193890,195315,194009,195886,194186,195454,194309,195911,194230,195550,194212,195291,194289,194902,193972,194542,194327,194277,194229,193897,194159,193678,194690,193267,194120,193262,194709,193247,194968,193360,194560,193489,195156,193513,194874,193790,194829,193859,194815,194006,194774,194597,194813,194794,194747,195099,194744,195747,194685,195485,194884,196432,195007,196597,195204,196429,195428,197259,195582,196984,195893,197092,196061,197101,196192,197112,196726,196976,196945,196981,197255,196894,197787,196741,197553,196925,198412,196856,198396,197079,198311,197183,198973,197237,198644,197470,198744,197469,198607,197568,198504,198051,198377,198040,198269,198418,198155,198780,198004,198625,198009,199553,198010,199363,198219,199548,198285,200195,198487,199852,198651,200071,198764,199956,198880,199906,199304,199725,199236,199524,199433,198938,199221,198040,198096,196973,197824,195605,196314,194572,195292,193576,194842,192531,193396,191868,192870,191097,191997,190617,191352,190554,190877,190217,190575,190596,190399,190716,190094,190623,190119,191458,190075,191223,190294,191654,190447,192375,190716,192070,191007,192572,191219,192470,191402,192570,191858,192565,191873,192508,192494,192557,192917,192521,193037,192609,193972,192514,193672,192770,194164,192843,194662,192876,194113,192914,194458,192796,193999,192779,193860,192830,193486,192600,193144,193007,192924,193043,192607,193010,192480,193554,192199,193201,192287,193719,192305,194124,192434,193698,192688,194335,192735,194119,193042,194137,193254,194190,193356,194191,194037,194178,194295,194220,194538,194215,195345,194186,195082,194418,195971,194494,196351,194819,196141,195044,196803,195272,196724,195573,196740,195730,196726,195865,196719,196489,196699,196599,196629,196911,196596,197456,196374,197157,196508,197993,196491,198079,196618,197945,196809,198641,196927,198363,197191,198352,197271,198311,197308,198278,197893,198145,197953,198086,198331,198055,198808,197916,198641,197975,199599,197954,199506,198232,199504,198343,200212,198494,199856,198695,199889,198579,199563,198254,198881,197958,197872,196919,196600,196179,195304,195301,193808,193933,192801,193695,191631,192555,190905,191865,190323,191912,189895,191062,189713,190879,189477,190587,189444,190430,189781,190283,189793,190217,190369,190095,190654,190023,190692,190190,191741,190318,191569,190515,191948,190734,192619,190969,192364,191300,192766,191431,192700,191713,192790,192118,192846,192271,192859,192904,192903,193266,192759,193388,192821,194091,192618,193653,192589,193891,192589,194338,192502,193750,192536,194078,192475,193626,192452,193420,192616,193238,192430,193001,192949,192790,193094,192657,193009,192609,193814,192465,193507,192615,194011,192726,194605,192934,194229,193231,194890,193379,194703,193686,194821,193994,194830,194103,194850,194787,194831,195025,194751,195286,194885,196032,194773,195861,195094,196624,195175,197009,195492,196738,195705,197515,195815,197224,196118,197280,196298,197233,196354,197166,196927,197052,197092,196942,197220,196836,197852,196659,197514,196756,198239,196759,198431,196872,198201,197125,198852,197155,198550,197375,198529,197498,198481,197541,198453,198152,198304,198202,198246,198566,198204,199071,198079,198871,198220,199762,198258,199773,198443,199685,198581,200364,198679,200087,198836,200028,198691,199482,198242,198668,197741,197464,196501,195996,195579,194623,194670,193176,193260,192094,193073,190971,191866,190224,191185,189774,191287,189337,190561,189293,190356,189002,190034,188972,189926,189433,189854,189386,189706,189924,189715,190302,189590,190245,189806,191215,189723,191052,189916,191353,190099,191968,190253,191644,190472,191913,190497,191757,190681,191781,191140,191731,191249,191679,191877,191720,192230,191562,192071,191562,192921,191374,192480,191378,192639,191341,193097,191288,192577,191273,192723,191157,192449,191248,192182,191453,191985,191354,191821,191767,191606,192007,191435,191955,191414,192761,191370,192473,191558,192910,191605,193542,191879,193134,192147,193689,192266,193578,192522,193667,192895,193619,193001,193575,193599,193622,193896,193614,194085,193650,194986,193594,194608,193882,195303,193970,195856,194224,195499,194477,196136,194582,195938,194911,195994,195137,195968,195184,195925,195802,195845,195920,195729,196196,195729,196766,195479,196439,195715,197159,195675,197514,195845,197088,195940,197777,196095,197492,196392,197492,196422,197433,196544,197349,197101,197222,197213,197129,197520,197130,198180,197006,197944,197210,198696,197253,198955,197558,198794,197762,199593,197964,199358,198168,199298,198115,198828,197648,198115,197250,196887,196167,195579,195261,194289,194480,192900,193149,191991,192982,191032,192087,190374,191312,189908,191499,189645,190824,189572,190672,189443,190431,189420,190347,189891,190315,190069,190252,190461,190298,191074,190203,191030,190467,191924,190557,191979,190777,192204,191018,192857,191234,192683,191602,192828,191679,192888,191946,192896,192449,193007,192633,192944,193151,192992,193615,192838,193424,192769,194220,192632,193758,192627,193865,192493,194232,192432,193719,192467,193773,192309,193454,192317,193239,192579,193095,192345,192738,192856,192619,193033,192395,192932,192395,193789,192335,193490,192460,193855,192687,194552,192824,194270,193204,194672,193324,194698,193684,194752,194141,194825,194292,194853,194969,194848,195287,194887,195399,194925,196315,194965,196125,195231,196648,195409,197313,195635,196994,195918,197604,196058,197423,196389,197488,196716,197427,196681,197386,197308,197316,197605,197251,197733,197230,198484,197169,198178,197335,198748,197421,199255,197565,198936,197805,199479,197956,199298,198230,199446,198576,199351,198675,199364,199161,199244,199353,199225,199623,199229,200326,199154,200223,199398,200908,199546,201349,199763,201154,200024,201800,200193,201589,200511,201602,200592,201507,200539,201175,200668,200567,200020,199450,199153,198118,198453,196732,196866,195558,196414,194432,195525,193570,194374,192990,194306,192353,193470,192129,193075,191876,192691,191768,192443,192033,192321,192142,192170,192507,192204,193038,192157,193048,192382,193929,192555,194134,192864,194286,193255,195121,193593,195017,194011,195322,194262};

// Coefficients des filtres passe-bas et passe-haut 
float32_t firCoeffs32_LowPass[NUM_TAPS] = {0.0134731639,0.0292821044,0.0713088173,0.1246269648,0.1685603447,0.1854972098,0.1685603447,0.1246269648,0.0713088173,0.0292821044,0.0134731639} ;
float32_t firCoeffs32_HighPass[NUM_TAPS] = {-0.0005744427,-0.0012061943,-0.0028606938,-0.0049069693,-0.0065631326,0.9922297889,-0.0065631326,-0.0049069693,-0.0028606938,-0.0012061943,-0.0005744427};


int main(void){

    SystemInit();
    SystemCoreClockUpdate();
    __enable_irq(); /* Enable global interrupts. */
    UART_1_Start();
    
    // C'etait pour un test que j'avais fait pour entrer  les valeurs brutes dans un test 
    /*
    for (int i= 0; i<BUFFER_LENGTH; i++){
       dataSpo2[RED][RAW][i] = testR[i];
       dataSpo2[IR][RAW][i] = testIR[i];
    }
    */
    xTaskCreate(TraitementSignal,"TraitementSignal",1000,NULL,0,0); // la tache de traitement de signal est créée
    vTaskStartScheduler();
    for(;;)
    {
       
    }
}

/* [] END OF FILE */
